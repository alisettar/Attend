@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> Localizer
@model DashboardStatisticsViewModel?

@{
    ViewData["Title"] = Localizer["Reports"];
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-graph-up me-2"></i>@Localizer["Reports"]</h2>
</div>

@if (Model == null)
{
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle me-2"></i>@Localizer["ErrorLoadingStatistics"]
    </div>
    return;
}

@* Statistics Cards *@
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="stat-card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-1">@Localizer["TotalEvents"]</h6>
                    <div class="stat-number">@Model.TotalEvents</div>
                </div>
                <i class="bi bi-calendar-event-fill"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-card h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-1">@Localizer["TotalUsers"]</h6>
                    <div class="stat-number">@Model.TotalUsers</div>
                </div>
                <i class="bi bi-people-fill"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-1">@Localizer["TotalAttendances"]</h6>
                    <div class="stat-number">@Model.TotalAttendances</div>
                </div>
                <i class="bi bi-clipboard-check-fill"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="stat-card h-100" style="background: linear-gradient(135deg, #20c997 0%, #17a085 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-1">@Localizer["TotalCheckedIn"]</h6>
                    <div class="stat-number">@Model.TotalCheckedIn</div>
                </div>
                <i class="bi bi-check-circle-fill"></i>
            </div>
        </div>
    </div>
</div>

@* Check-in Rate *@
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    <i class="bi bi-percent me-2"></i>@Localizer["CheckInRate"]
                </h5>
                <div class="progress" style="height: 30px;">
                    <div class="progress-bar bg-success" role="progressbar" 
                         style="width: @Model.CheckInRate%" 
                         aria-valuenow="@Model.CheckInRate" aria-valuemin="0" aria-valuemax="100">
                        <strong>@Model.CheckInRate.ToString("F2")%</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    @* Top Events *@
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary bg-opacity-10">
                <h5 class="mb-0">
                    <i class="bi bi-trophy-fill me-2 text-primary"></i>@Localizer["TopEvents"]
                </h5>
            </div>
            <div class="card-body">
                @if (Model.TopEvents.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>@Localizer["Event"]</th>
                                    <th class="text-center">@Localizer["Registered"]</th>
                                    <th class="text-center">@Localizer["CheckedIn"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var evt in Model.TopEvents)
                                {
                                    <tr>
                                        <td>
                                            <a asp-controller="Events" asp-action="Details" asp-route-id="@evt.Id">
                                                <strong>@evt.Title</strong>
                                            </a>
                                            <br />
                                            <small class="text-muted">@evt.Date.ToString("dd MMM yyyy")</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-secondary">@evt.AttendanceCount</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-success">@evt.CheckedInCount</span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-info text-center mb-0">
                        <i class="bi bi-info-circle me-2"></i>@Localizer["NoEventsYet"]
                    </div>
                }
            </div>
        </div>
    </div>

    @* Top Users *@
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info bg-opacity-10">
                <h5 class="mb-0">
                    <i class="bi bi-star-fill me-2 text-info"></i>@Localizer["TopUsers"]
                </h5>
            </div>
            <div class="card-body">
                @if (Model.TopUsers.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>@Localizer["User"]</th>
                                    <th class="text-center">@Localizer["Registered"]</th>
                                    <th class="text-center">@Localizer["CheckedIn"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var user in Model.TopUsers)
                                {
                                    <tr>
                                        <td>
                                            <a asp-controller="Users" asp-action="Details" asp-route-id="@user.Id">
                                                <strong>@user.Name</strong>
                                            </a>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-secondary">@user.AttendanceCount</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-success">@user.CheckedInCount</span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-info text-center mb-0">
                        <i class="bi bi-info-circle me-2"></i>@Localizer["NoUsersYet"]
                    </div>
                }
            </div>
        </div>
    </div>
</div>
